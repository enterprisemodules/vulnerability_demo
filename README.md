[![Enterprise Modules](https://raw.githubusercontent.com/enterprisemodules/public_images/master/banner1.jpg)](https://www.enterprisemodules.com)
# Demo Puppet vulnerability management

We will show you how you can integrate vulnerability scanning and remediation into your Puppet workflow in this demo.

You can use this demo with Puppet Enterprise or start the nodes masterless to view how it works quickly.

## Scanning vulnerabilities

After starting the modes (see following paragraphs), you can log in to the system:

```
$ vagrant ssh <pe-centos7|ml-centos7|ml-centos-8>
```

You are now logged into the system as a user `vagrant`. To become root user, issue the `sudo -i' command.

The first puppet run has installed all required software and configured all required files. Puppet will start a vulnerability scan on the whole system on your next puppet run. On masterless systems:

```
$ puppet apply /etc/puppetlabs/code/environments/production/manifests/site.pp -t
```

When using PE:

```
$ puppet agent -t
```

You can notice it is scanning because after showing `Info: Loading facts`, it takes some time before continuing.

## Inspecting the vulnerabilities from the command-line

After this puppet run, you can now inspect the vulnerabilities:

```
$ puppet vulnerability list --summary
Critical Vulnerabilities:    0 found.
High Vulnerabilities:        8 found.
```

If you would like to see all details, you can use this command:

```
$ puppet vulnerability list --summary --details
{ "CVE-2016-7545"=>
  {"artifact_name"=>"selinux",
   "version"=>2.9,
   "severity"=>"High",
   "fix_state"=>"unknown",
   "locations"=>
    ["/usr/lib64/python3.6/site-packages/selinux-2.9-py3.6.egg-info"]},
 "CVE-2021-0920"=>
  {"artifact_name"=>"python3-perf",
   "version"=>"4.18.0-348.2.1.el8_5",
   "severity"=>"High",
   "fix_state"=>"not-fixed",
   "locations"=>["/var/lib/rpm/Packages"]},
   ...
}
Critical Vulnerabilities:    0 found.
High Vulnerabilities:        8 found.
```

## Using facts to manage the vulnerabilities

### On the nodes

The integration ensures that the found Vulnerabilities (CVE's) are available as facts on the system. You can inspect the fact like this:

```
$ puppet facts cve_list
{
  "cve_list": {
    "CVE-2005-2541": {
      "artifact_name": "tar",
      "fix_state": "wont-fix",
      "locations": [
        "/var/lib/rpm/Packages"
      ],
      "severity": "Medium",
      "version": "2:1.30-5.el8"
    },
    "CVE-2011-1017": {
      "artifact_name": "python3-perf",
      "fix_state": "wont-fix",
      "locations": [
        "/var/lib/rpm/Packages"
      ],
      "severity": "Medium",
      "version": "4.18.0-348.2.1.el8_5"
    },
    ...
    .
    .
    .
  }
}
```

Since this information is available to all puppet manifest, you can use this fact to ensure a specific puppet code is applied to your system if a certain CVE is found. This is extremely powerful.

### On the Puppetserver

Because it is a regular Puppet fact, you can also see this on the Puppetserver. Here is a screenshot of inspecting the facts of a specific node on the Puppetserver.

![Facts on the puppetserver](https://github.com/enterprisemodules/vulnerability_demo/raw/main/images/puppet-server-facts.jpg)


## More information

You can find more information about integrating vulnerability scanning into your Puppet workflow here:

- [Detecting and resolving vulnerabilities with Puppet](https://www.enterprisemodules.com/news/2021/12/detecting-and-resolving-vulnerabilities-with-puppet/)
- [Documentation vulnerability module](https://www.enterprisemodules.com/docs/vulnerability/description.html)
- [Vulnerability management](https://www.enterprisemodules.com/shop/products/puppet-vulnerability-management)

## Running the machines

### Starting the nodes masterless

All nodes are available to test with Puppet masterless. To do so, add `ml-` for the name when using vagrant:


<ml-centos7|ml-centos8|ml-win2016>


```
$ vagrant up <ml-centos7|ml-centos8|ml-win2016>
```

### Starting the nodes with PE

You can also test with a Puppet Enterprise server. To do so, add `pe-` for the name when using vagrant:

```
$ vagrant up pe-puppetserver
$ vagrant up <pe-centos8|pe-win2016>
```

After the puppetserver is up, you can log into it by using the following url https://192.168.56.10/. Using the username `admin` and the password `welcome01`. Depending on your OS, you might have to add this line to your `/etc/hosts` file:

```
192.168.56.10 puppetserver.example.com
```

#### ordering

You must always use the specified order:

1. pe-puppetserver
2. <pe-centos8|pe-win2016>

### Required software

The software must be placed in `modules/software/files`. It must contain the following files:

### Puppet Enterprise (Not needed when using masterless deployments)
- [puppet-enterprise-2021.4.0-el-8-x86_64.tar.gz (Extracted tar)](https://puppet.com/download-puppet-enterprise)

